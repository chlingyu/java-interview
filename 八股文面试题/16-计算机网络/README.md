# 16 - 计算机网络

> 覆盖计算机网络核心知识：TCP 三次握手与四次挥手、HTTP/HTTPS、TCP vs UDP、Cookie/Session 等高频面试考点。三次握手和 HTTPS 几乎每场必问。

---

## 一、TCP

### 1. TCP 三次握手和四次挥手？

> ⭐⭐⭐⭐⭐ 必考 | 难度：⭐⭐⭐

**一句话回答**：三次握手建立连接（SYN → SYN+ACK → ACK），四次挥手断开连接（FIN → ACK → FIN → ACK）。

**通俗理解**：

**三次握手**就像打电话：
1. 你：「喂，听得到吗？」（SYN）
2. 对方：「听得到，你听得到我吗？」（SYN + ACK）
3. 你：「听得到，开始说正事吧」（ACK）

**四次挥手**就像挂电话：
1. 你：「我说完了」（FIN）
2. 对方：「好的我知道了，等我把最后几句说完」（ACK）
3. 对方：「我也说完了，挂了」（FIN）
4. 你：「好的，挂了」（ACK）→ 等一会儿确认对方挂了再放下电话（TIME_WAIT）

**回到技术**："喂听得到吗"就是客户端发送 SYN 报文请求建立连接。"你听得到我吗"就是服务端回复 SYN+ACK 确认并请求反向连接。"听得到"就是客户端确认，连接建立。挥手多一次是因为 TCP 是全双工的，每个方向的关闭需要单独确认。

**原理详解**：

```
三次握手：
客户端                    服务端
  │── SYN(seq=x) ──────→│    ① 客户端发 SYN，进入 SYN_SENT
  │←─ SYN+ACK(seq=y,     │    ② 服务端回 SYN+ACK，进入 SYN_RCVD
  │   ack=x+1) ─────────│
  │── ACK(ack=y+1) ────→│    ③ 客户端回 ACK，双方进入 ESTABLISHED
```

```
四次挥手：
客户端                    服务端
  │── FIN ──────────────→│    ① 客户端发 FIN，进入 FIN_WAIT_1
  │←─ ACK ───────────────│    ② 服务端回 ACK，进入 CLOSE_WAIT
  │                       │    （服务端可能还有数据要发）
  │←─ FIN ───────────────│    ③ 服务端发 FIN，进入 LAST_ACK
  │── ACK ──────────────→│    ④ 客户端回 ACK，进入 TIME_WAIT
  │                       │    等待 ⚡2MSL 后关闭
```

> **为什么是三次握手不是两次？** 防止已失效的连接请求到达服务端。如果只有两次，客户端一个延迟的 SYN 到达服务端，服务端回 ACK 就建立连接了，但客户端根本不会发数据，白白浪费服务端资源。

> **为什么 TIME_WAIT 要等 2MSL？** MSL（Maximum Segment Lifetime）是报文最大生存时间。等 ⚡**2MSL** 是为了确保最后一个 ACK 能到达服务端，如果服务端没收到会重发 FIN，客户端还能再回 ACK。

**🎤 面试这样答**：
> "TCP 三次握手：客户端发 SYN，服务端回 SYN+ACK，客户端再回 ACK，连接建立。三次而不是两次是为了防止失效的连接请求导致服务端白白建立连接。四次挥手：一方发 FIN 表示不再发数据，对方 ACK 确认，等对方也发完数据后再发 FIN，最后 ACK 确认。比握手多一次是因为 TCP 全双工，每个方向需要单独关闭。客户端最后要等 2MSL 再关闭，确保最后的 ACK 能到达。"

---

### 2. TCP 和 UDP 的区别？

> ⭐⭐⭐⭐⭐ 必考 | 难度：⭐⭐

**一句话回答**：TCP 是可靠的、面向连接的传输协议；UDP 是不可靠的、无连接的传输协议。TCP 像打电话，UDP 像发短信。

| 对比项 | TCP | UDP |
|--------|-----|-----|
| 连接 | ⚡**面向连接**（三次握手） | 无连接，直接发 |
| 可靠性 | ⚡**可靠**（确认、重传、排序） | 不可靠，可能丢包 |
| 传输方式 | 字节流 | 数据报 |
| 速度 | 较慢（有确认和重传开销） | ⚡**更快** |
| 适用场景 | 文件传输、HTTP、数据库连接 | 视频直播、DNS、游戏 |

> **面试追问**：TCP 怎么保证可靠传输？通过⚡**确认应答（ACK）、超时重传、滑动窗口（流量控制）、拥塞控制**四个机制。

---

## 二、HTTP

### 3. HTTP 和 HTTPS 的区别？

> ⭐⭐⭐⭐⭐ 必考 | 难度：⭐⭐⭐

**一句话回答**：HTTPS = HTTP + SSL/TLS 加密层。HTTP 是明文传输，HTTPS 是加密传输，防止数据被窃听和篡改。

**通俗理解**：

- **HTTP** = 寄明信片，邮递员和路上任何人都能看到你写的内容
- **HTTPS** = 寄密封信，信封上了锁，只有收件人有钥匙能打开

**回到技术**："上锁"就是 SSL/TLS 协议在 HTTP 和 TCP 之间加了一层加密。数据在传输前先加密，到达后再解密，中间人即使截获也看不懂。

| 对比项 | HTTP | HTTPS |
|--------|------|-------|
| 端口 | ⚡**80** | ⚡**443** |
| 安全性 | 明文传输，不安全 | ⚡**加密传输**，防窃听、防篡改 |
| 证书 | 不需要 | 需要 CA 证书 |
| 性能 | 快 | 稍慢（多了 TLS 握手） |

**HTTPS 的加密过程（TLS 握手，简化版）**：

```
① 客户端发起请求，发送支持的加密算法列表
② 服务端返回数字证书（包含公钥）
③ 客户端验证证书合法性，生成随机密钥，用公钥加密后发给服务端
④ 服务端用私钥解密，拿到随机密钥
⑤ 双方用这个随机密钥进行对称加密通信
```

> **为什么不全程用非对称加密？** 非对称加密（RSA）⚡**性能差**，只用来交换密钥。实际数据传输用⚡**对称加密**（AES），速度快得多。

**🎤 面试这样答**：
> "HTTPS 就是在 HTTP 基础上加了 SSL/TLS 加密层。TLS 握手过程中，先用非对称加密交换一个随机密钥，之后的数据传输用这个密钥做对称加密。这样既保证了密钥交换的安全性，又保证了数据传输的性能。HTTP 用 80 端口，HTTPS 用 443 端口，HTTPS 需要 CA 证书。"

---

### 4. HTTP 常见状态码？

> ⭐⭐⭐ 常问 | 难度：⭐

**回答**：HTTP 状态码分 5 类，面试记住常见的几个就行。

| 分类 | 含义 | 常见状态码 |
|------|------|-----------|
| **1xx** | 信息性 | 100 Continue |
| **2xx** | ⚡**成功** | 200 OK、201 Created、204 No Content |
| **3xx** | 重定向 | 301 永久重定向、302 临时重定向、304 Not Modified（缓存） |
| **4xx** | ⚡**客户端错误** | 400 Bad Request、401 未认证、403 无权限、404 Not Found |
| **5xx** | ⚡**服务端错误** | 500 Internal Server Error、502 Bad Gateway、503 Service Unavailable |

> 面试重点记住：200（成功）、301/302（重定向）、400（参数错误）、401（未登录）、403（没权限）、404（找不到）、500（服务器内部错误）。

---

### 5. GET 和 POST 的区别？

> ⭐⭐⭐ 常问 | 难度：⭐

**回答**：简单说，GET 用来获取数据，参数在 URL 中；POST 用来提交数据，参数在请求体中。

| 对比项 | GET | POST |
|--------|-----|------|
| 用途 | 获取资源 | 提交/修改数据 |
| 参数位置 | URL 中（`?key=value`） | 请求体中 |
| 安全性 | 参数暴露在 URL，⚡**相对不安全** | 参数在请求体，相对安全 |
| 长度限制 | 浏览器对 URL 长度有限制（约 2KB） | 无限制 |
| 幂等性 | ⚡**幂等**（多次请求结果一样） | 非幂等 |
| 缓存 | 可以被浏览器缓存 | 不会被缓存 |

> **本质区别**：从 HTTP 协议层面看，GET 和 POST 都是 TCP 连接，没有本质区别。上面的区别更多是⚡**约定和规范**，而不是技术限制。

---

## 三、会话管理

### 6. Cookie 和 Session 的区别？

> ⭐⭐⭐⭐ 高频 | 难度：⭐⭐

**一句话回答**：Cookie 存在客户端（浏览器），Session 存在服务端。Cookie 不安全但减轻服务器压力，Session 安全但占服务器内存。

**通俗理解**：

- **Cookie** = 你去超市，超市给你一张会员卡，卡上写着你的信息。下次来你出示会员卡，超市就知道你是谁。卡在你手上，可能被别人偷看
- **Session** = 超市给你一个号码牌（Session ID），你的信息存在超市的电脑里。你只需要出示号码牌，超市根据号码查电脑就知道你是谁

**回到技术**："会员卡上写信息"就是 Cookie 把数据存在浏览器端，每次请求自动带上。"号码牌"就是 Session ID，通过 Cookie 传递给浏览器，服务端根据这个 ID 查找对应的 Session 数据。

| 对比项 | Cookie | Session |
|--------|--------|---------|
| 存储位置 | ⚡**客户端**（浏览器） | ⚡**服务端** |
| 安全性 | 较低，可被篡改和窃取 | 较高，数据在服务端 |
| 大小限制 | 单个 Cookie ⚡**≤ 4KB** | 无限制（受服务器内存限制） |
| 生命周期 | 可设置过期时间，关闭浏览器可保留 | 默认关闭浏览器失效（可配置） |

> **实际应用**：Session 依赖 Cookie 来传递 Session ID。服务端创建 Session 后，把 Session ID 通过 Cookie 发给浏览器，后续请求浏览器自动带上这个 Cookie。现在前后端分离项目更多用 ⚡**JWT（Token）** 代替 Session，无状态，适合分布式环境。

**🎤 面试这样答**：
> "Cookie 存在客户端浏览器，Session 存在服务端。Session 通过 Cookie 传递 Session ID 来关联用户。Cookie 不安全可能被篡改，单个不超过 4KB；Session 安全但占服务器内存。现在前后端分离项目更多用 JWT 代替 Session，无状态不占服务端内存，适合分布式环境。"

---

## 四、综合

### 7. 浏览器输入 URL 到页面展示，发生了什么？

> ⭐⭐⭐⭐⭐ 必考 | 难度：⭐⭐⭐

**一句话回答**：DNS 解析 → TCP 连接 → 发送 HTTP 请求 → 服务器处理 → 返回响应 → 浏览器渲染页面。

**通俗理解**：

就像你网购一件商品：
1. **查地址**（DNS 解析）= 你输入店铺名，平台帮你查到店铺的仓库地址
2. **建立联系**（TCP 三次握手）= 你和仓库确认"能发货吗？""能！""好，下单了"
3. **下单**（发送 HTTP 请求）= 你把订单信息发给仓库
4. **仓库发货**（服务器处理并返回响应）= 仓库找到商品，打包发出
5. **收货拆箱**（浏览器解析渲染）= 你收到包裹，拆开摆好

**回到技术**：

```
① DNS 解析：把域名（www.baidu.com）解析成 IP 地址
   浏览器缓存 → 系统缓存 → 路由器缓存 → DNS 服务器

② TCP 连接：与服务器进行三次握手建立连接
   如果是 HTTPS，还要进行 TLS 握手

③ 发送 HTTP 请求：浏览器构造 HTTP 请求报文发送给服务器

④ 服务器处理：服务器接收请求，执行业务逻辑，返回 HTTP 响应

⑤ 浏览器渲染：
   解析 HTML → 构建 DOM 树
   解析 CSS  → 构建 CSSOM 树
   合并成渲染树 → 布局（Layout）→ 绘制（Paint）

⑥ 断开连接：四次挥手关闭 TCP 连接
```

**🎤 面试这样答**：
> "首先浏览器做 DNS 解析，把域名转成 IP 地址，会依次查浏览器缓存、系统缓存、DNS 服务器。然后与服务器建立 TCP 连接，三次握手，如果是 HTTPS 还要 TLS 握手。接着发送 HTTP 请求，服务器处理后返回响应。浏览器拿到 HTML 后开始渲染：解析 HTML 构建 DOM 树，解析 CSS 构建 CSSOM 树，合并成渲染树，然后布局和绘制。最后四次挥手断开连接。"

---

## 面试高频程度排序（3~5 年）

| 优先级 | 题目 |
|--------|------|
| ⭐⭐⭐⭐⭐ | TCP 三次握手和四次挥手？ |
| ⭐⭐⭐⭐⭐ | TCP 和 UDP 的区别？ |
| ⭐⭐⭐⭐⭐ | HTTP 和 HTTPS 的区别？ |
| ⭐⭐⭐⭐⭐ | 浏览器输入 URL 到页面展示？ |
| ⭐⭐⭐⭐ | Cookie 和 Session 的区别？ |
| ⭐⭐⭐ | HTTP 常见状态码？ |
| ⭐⭐⭐ | GET 和 POST 的区别？ |
